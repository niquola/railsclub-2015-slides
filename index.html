<!doctype html>
<html lang="en">

<head>
<meta charset="utf-8">

<title>railsclub</title>

<meta name="description" content="Presentation about javascript & postgres">
<meta name="author" content="Nikolay Ryzhikov">

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

<link rel="stylesheet" href="css/reveal.css">
<link rel="stylesheet" href="css/theme/white.css" id="theme"/>
<link rel="stylesheet" href="lib/css/zenburn.css"/>


<!-- Code syntax highlighting -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">

<!-- Printing and PDF exports -->
<script>
var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
document.getElementsByTagName( 'head' )[0].appendChild( link );
</script>

<!--[if lt IE 9]><script src="lib/js/html5shiv.js"></script><![endif]-->
<style>
.reveal pre code {
  background: #fdf6e3;
  color: #657b83;
  padding: 10px;
}
.reveal section img {
  border: none;
  box-shadow: none;
}
.slidernav img{
  width: 80px;
  display: inline-block;
  margin: 10px;
}
h3 strong {
  color: #DC322F;
}

.red {
  color: #DC322F !important;
}

.reveal h1, .reveal h2, .reveal h3, .reveal h4, .reveal h5, .reveal h6 {
  color: #002B36;
}

.reveal .progress span {
  background: #2AA198;
}

.reveal .controls div.navigate-left, .reveal .controls div.navigate-left.enabled {
  border-right-color: #CB4B16;
}

.reveal .controls div.navigate-right, .reveal .controls div.navigate-right.enabled {
  border-left-color: #CB4B16;
}
.reveal blockquote {
  background: #FDF6E3;
}
</style>
</head>

<body>

<div class="reveal">
  <div class="slides">
    <section>
      <h3 style="font-size: 63px;"><strong style="letter-spacing: 8px">Functional</strong>
        <br/><strong>Programming</strong>
        <br>
        <span style="letter-spacing: 6px">for rubists</span></h3>
      <p>
      <small style="letter-spacing: 4.5px">Created by <a href="http://github.com/niquola">niquola</a> / <a href="http://twitter.com/niquola">@niquola</a></small>
      </p>
    </section>

    <section style="top: 0px; display: block;" class="present">
      <h5 style="letter-spacing: 3.5px">Nikolay Ryzhikov</h5>
      <img src="niquola.jpg" style="border:none; height: 500px; box-shado: none; background: transparent;">
      <p style="letter-spacing: 32px;">
      <a href="http://github.com/niquola">
        <i class="fa fa-github"></i>
      </a>
      <a href="http://twitter.com/niquola">
        <i class="fa fa-twitter"></i>
      </a>
      <a href="https://plus.google.com/u/0/+%D0%9D%D0%B8%D0%BA%D0%BE%D0%BB%D0%B0%D0%B9%D0%A0%D1%8B%D0%B6%D0%B8%D0%BA%D0%BE%D0%B2">
        <i class="fa fa-google-plus"></i>
      </a>
      <a href="https://www.facebook.com/nicola.ryzhikov">
        <i class="fa fa-facebook"></i>
      </a>
      </p>
    </section>

    <section>
      <img src="rabbit_hole.jpg"/>
    </section>

    <section>
      <h3 style="margin-bottom: 0px;">Функции</h3>
      <p  style="margin-top: 0px;">применяються</p>
      <hr/>
      <h3 style="margin-bottom: 0px;">Данные</h3>
      <p  style="margin-top: 0px;letter-spacing: 9px;">значения</p>
      <hr/>
      <p class="red">Нет объектов и классов</p>
    </section>

    <section>
      <h3>Чистые Функции</h3>
    <pre><code>
    list = [1, 2, 3]

    new_list = push(list, 4)

    puts list # => [1, 2, 3]

    puts new_list # => [1, 2, 3, 4]
    </pre></code>
    </section>

    <section>
      <h3>Чистые Функции</h3>
    <pre><code>
    mapa = {a: 1}

    new_mapa = assoc(mapa, :b, 2)

    puts mapa #=> {a: 1}

    puts new_mapa #=> {a: 1, b: 2}
    </pre></code>
    </section>

    <section>
      <h3>Всегда одно и тоже</h3>
      <pre><code>cos(&#960;) => 1</pre></code>
      <pre><code>cos(&#960;) => 1</pre></code>
      <pre><code>cos(&#960;) => 1</pre></code>
      <img src="notime.png"/>
    </section>

    <section>
      <h3 style="font-size:43px">Чего бы вокруг не происходило</h3>
      <pre><code>cos(&#960;) => 1</pre></code>
      <img src="apocalypse.jpg"/>
    </section>

    <section>
      <h3 style="margin-bottom:0px">Вообще ничего</h3>
      <h3 style="font-size: 62px; margin-top:0px">не поменять</h3>
      <img src="copy-icon.png"/>
    </section>

    <section>
      <h3 style="font-size: 58px;margin-bottom:0px">И нет переменных</h3>
      <img src="vars.jpg"/>
      <p style="font-size: 52px;margin-bottom:0px">Вообще ничего не прячут</p>
    </section>

    <section>
      <h3 style="font-size: 45px;">передавать все явно</h3>
      <img src="pipe.jpg"/>
    </section>

    <section>
      <h3>Kомпозиция</h3>
      <hr/>
      <pre><code>
      f(g(h(x)))

      f.g.h x

      (-> (h x) g f)
      </pre></code>
    </section>

    <section>
      <h3>У нас Программы - графы</h3>
      <img src="graph.png"/>
    </section>

    <section>
      <h3>A у них - деревья</h3>
      <img src="tree.png"/>
    </section>

    <section>
      <h3>Не выполняются</h3>
      <img src="expression_tree.png"/>
      <h3>а вычисляються</h3>
    </section>

    <section>
      <h3 style="font-size: 33px;">Функции высших порядков</h3>
      <img src="aristo.jpg"/>
    </section>

    <section>
      <h3 style="font-size:53px;" >Принимают функции</h3>
      <p style="font-size: 47px;">параметризация вычисления</p>
      <hr/>
      <h3>Возвращают функции</h3>
      <p style="font-size: 47px;letter-spacing: 2.5px;">конструкторы вычислений</p>
    </section>

    <section>
      <h3>fold (reduce)</h3>
      <pre><code>
      # fold(col, init-value, &proc)
      sum = fold([1,2,3], 0,+)
      prod = fold([1,2,3], 0,*)

      map = fn (f, col)
        fold col, [] do |acc,x|
          push(acc,f(x))
        end
      end

      filter = fn (pred, col)
        fold col, [] do |acc,x|
          pred(x) ?  push(acc,f(x)) : acc
        end
      end
      </pre></code>
    </section>

    <section>
      <h3>wrap (middle-ware)</h3>
      <pre><code>
      fn wrap(f)
        fn (x)
          if ???
            f(x)
          else
            return ???
          end
        end
      end
      </pre></code>
      <p>Like our decorators <br/>or chain of responsibility</p>
    </section>

    <section>
      <h3>compose wrappers</h3>
      <pre><code>
      f' =  wrap(f)
      f'' = other_wrap'(f')
      ....
      ....
      ....
      f''''(x)
      </pre></code>
    </section>


    <section>
      <h3>Transducers</h3>
      <pre><code>
      # chain(acc,elem)
      chain = compose(
        filter(odd?),
        map(double),
        take(5)
      )

      reduce(chain, [], coll)
      </pre></code>
      <p>собираем вычисление, потом выполняем</p>
    </section>

    <section>
      <h3 style="font-size: 45px;">Изменяемое состояние</h3>
      <img src="mutable.jpg"/>
    </section>

    <section>
      <h3>Software Transactional Memory</h3>
      <pre><code>
      # isolation
      transaction do
        change(state1)
        change(state2)
      end
      </pre></code>
      <p>Ни тебе race condition, dead lock, incosistent read</p>
    </section>

    <section>
      <h3 style="font-size: 45px;">Функциональное ядро</h3>
      <img src="core.jpg"/>
    </section>

    <section>
      <h3 style="font-size: 45px;">А как они пишут WEB?</h3>
    </section>

    <section>
      <h3>Web Server у них функция</h3>
      <pre><code>
      fn server(req)
        return {
          status: 200,
          body: "Hello",
          headers: {
            ContentType: 'text'
          }
        }
      end

      server({uri: "/home", params: {q: '???'}})
      </pre></code>
    </section>

    <section>
      <h3>Обертки для Middle-Ware</h3>
      <pre><code>
      server = compose(
        wrap_params,
        wrap_cookies,
        wrap_json_request,
        wrap_form_params,
        dispatch
      )

      server(request)
      </pre></code>
      <p>Наш rack</p>
    </section>

    <section>
      <h3>Routing</h3>
      <pre><code>
      # dispatch(request, routes_spec) -> handler

      fn dispatch(request, routes_spec)
         handler = find_in_routes(request, routes_spec)
         handler(request)
      end
      </pre></code>

      <p>Они ничего не знают про паттерны</p>
    </section>

    <section>
      <h3>Route Spec просто данные</h3>
      <pre><code>
      route_spec = {
        admin: {
          users: {
            POST: users/create
            GET:  users/index
           }
        }
      }

      route_spec = [
        ["admin", "users", "POST", users/create],
        ["admin", "users", "GET",  users/create],
      ]
      </pre></code>

      <h2>1-3 files; ~100 SLOC total</h2>
    </section>

    <section>
      <h3>gem "journey"</h3>
      <h3>1.6K SLOC + 1.5K tests</h3>
      <hr/>
      <h3 class="red">*10 times bigger</h3>
    </section>

    <section>
      <h3>View & Templating у них тоже функция</h3>
      <pre><code>
      fn layout(content)
        [:html,
          [:header,
            [:title "layout"]],
          [:body, menu() content]]
      end


      def render(data)
        layout(
          [:ul, map data {|x|
             [:li, link_to(x.url, x.text)]}]
      end
      </pre></code>
      <h3> ~600 SLOC + form builder</h3>
    </section>

    <section>
      <p>Я же говорю одни функции</p>
      <pre><code>
      layout1(
        layout2(content1()),
        layout3(content2())
      )

      def decorate_user(user)
        user[:full_name] = user[:first_name] + user[:last_name]
        user
      end

      def link_to(url, label)
        [:a, {href: url}, label]
      end
      </pre></code>
      <p>нет проблем с лайаутами и хэлперами</p>
    </section>

    <section>
      <h3>haml</h3>
      <h3>2.6K SLOC + 3K tests</h3>
      <hr/>
      <h3 class="red">*10 times bigger</h3>
    </section>

    <section>
      <h3>А ORM?</h3>
      <hr/>
      <p> Ups, а объектов то нет</p>
    </section>

    <section>
      <p>А работа с базой?</p>
      <pre><code>
      query = {
        select: [:id, :name], from: "users",
        where: [:name "=" x]
      }

      fn by_name(name, query)
        merge(query, :where,["name", "ilike", name])
      end

      fn active_users(query)
        merge(query, :where,["status", "=", "active"])
      end

      conn/exec( sql( active_users( by_name("nicola", query)))
      </pre></code>
      <p>опять функции ~ 800 SLOC</p>
    </section>

    <section>
      <h3>Arel</h3>
      <h3>3.4K SLOC + 5K tests</h3>
    </section>

    <section>
      <h3>Функциональный Web?</h3>
      <pre><code>
  String:HTTP -> fns ->  String:SQL -> DB -> fns -> String:HTTP
      </pre></code>
    </section>

    <section>
      <h3>Функциональный UI?</h3>
      <hr/>
      <pre><code>
    State -> ui_function -> VirtualDom -> React.diff/patch -> DOM

    Event -> change State -> State'

    State' -> ui_function -> VirtualDom -> React.diff/patch -> DOM
      </pre></code>
    </section>

    <section>
      <h3>А фреймворки есть?</h3>
      <hr/>
      <p>Почти нет, много маленьких библиотек,<br/>
      которые легко склеиваются</p>
    </section>

    <section>
      <h3>А почему они маленькие?</h3>
      <hr/>
      <p>Сильно сфокусированны на задаче</p>
      <p>SOLIDные</p>
    </section>

    <section>
      <h3>Но мы тоже</h3>
      <hr/>
      <p>Почему мы тогда тратим в 10 раз больше сил?</p>
    </section>

    <section>
      <h3>Почему композиция - проблема?</h3>
      <hr/>
      <p>Почему декомпозиция тоже проблема?</p>
    </section>

    <section>
      <h3>Почему в рабстве у фреймворка?</h3>
    </section>

    <section>
      <h3>Почему нам нужно<br/> больше думать?</h3>
      <hr/>
      <ul>
        <li>SOLID?</li>
        <li>Service Object?</li>
        <li>DCI?</li>
        <li>Mixins/Traits?</li>
      </ul>
      <hr/>
      <p>а они просто для этого пишут функцию</p>
    </section>

    <section>
      <h3>Thx</h3>
      <hr/>
      <h2>Q?</h2>
    </section>
  </div>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

// Full list of configuration options available at:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
controls: true,
progress: true,
history: true,
center: true,

transition: 'slide', // none/fade/slide/convex/concave/zoom

// Optional reveal.js plugins
dependencies: [
{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
{ src: 'plugin/highlight/highlight.pack.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
{ src: 'plugin/zoom-js/zoom.js', async: true },
{ src: 'plugin/notes/notes.js', async: true }
]
});

</script>

<script src="https://raw.githubusercontent.com/isagalaev/highlight.js/master/src/languages/clojure.js">
</body>
</html>
